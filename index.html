<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutrientDriftAI: Personal AI Nutrition Analyst</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            color: #ffffff;
            overflow-x: hidden;
            background: #0f2027;
            min-height: 100vh;
        }
        
        /* Main Layout with Sidebar */
        .main-layout {
            display: flex;
            min-height: 100vh;
        }
        
        /* Left Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: rgba(15, 32, 39, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px 20px;
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            z-index: 100;
            overflow-y: auto;
            transition: transform 0.3s ease;
        }
        
        .sidebar-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-logo {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(90deg, #4CAF50, #2196F3);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            letter-spacing: -0.5px;
        }
        
        .sidebar-tagline {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .nav-menu {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            font-weight: 500;
        }
        
        .nav-item:hover {
            background: rgba(76, 175, 80, 0.1);
            border-color: rgba(76, 175, 80, 0.3);
            color: #4CAF50;
            transform: translateX(5px);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(33, 150, 243, 0.2));
            border-color: rgba(76, 175, 80, 0.3);
            color: #4CAF50;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .nav-item i {
            font-size: 22px;
            width: 24px;
        }
        
        .sidebar-footer {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
        }
        
        /* Main Content Area */
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 30px;
            position: relative;
        }
        
        /* Sound Controls */
        .sound-controls {
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            padding: 10px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .sound-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.3);
            color: #4CAF50;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .sound-btn:hover {
            background: rgba(76, 175, 80, 0.3);
            transform: scale(1.1);
        }
        
        .sound-btn.active {
            background: #4CAF50;
            color: white;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
        }
        
        /* Enhanced Background Effects */
        .background-effects {
            position: fixed;
            top: 0;
            left: 280px;
            width: calc(100% - 280px);
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }
        
        .animated-gradient {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #0f2027, #203a43, #2c5364, #1a3a47, #0d2533);
            background-size: 400% 400%;
            animation: gradient-shift 15s ease infinite;
            opacity: 0.8;
        }
        
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .geometric-shape {
            position: absolute;
            opacity: 0.2;
            filter: blur(1px);
        }
        
        .shape-circle {
            border-radius: 50%;
            background: radial-gradient(circle, rgba(76, 175, 80, 0.7), rgba(76, 175, 80, 0));
            animation: float-shape 20s infinite linear;
        }
        
        @keyframes float-shape {
            0% { transform: translateY(100vh) translateX(0) rotate(0deg); }
            100% { transform: translateY(-100vh) translateX(100px) rotate(360deg); }
        }
        
        .nutrient-particles {
            position: absolute;
            top: 0;
            left: 280px;
            width: calc(100% - 280px);
            height: 100%;
            overflow: hidden;
            z-index: 2;
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            filter: blur(2px);
            animation: float 20s infinite linear;
        }
        
        .particle-green {
            background: radial-gradient(circle, rgba(76, 175, 80, 0.7), rgba(76, 175, 80, 0));
        }
        
        .particle-blue {
            background: radial-gradient(circle, rgba(33, 150, 243, 0.7), rgba(33, 150, 243, 0));
        }
        
        .particle-yellow {
            background: radial-gradient(circle, rgba(255, 193, 7, 0.7), rgba(255, 193, 7, 0));
        }
        
        .particle-red {
            background: radial-gradient(circle, rgba(244, 67, 54, 0.7), rgba(244, 67, 54, 0));
        }
        
        @keyframes float {
            0% { transform: translateY(100vh) translateX(0) scale(0); opacity: 0; }
            10% { opacity: 0.7; }
            90% { opacity: 0.7; }
            100% { transform: translateY(-100vh) translateX(100px) scale(1.5); opacity: 0; }
        }
        
        /* App Container */
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }
        
        /* Screens */
        .screen {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease, transform 0.5s ease;
            transform: translateY(20px);
            min-height: calc(100vh - 60px);
        }
        
        .screen.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
            animation: screen-appear 0.6s ease-out;
        }
        
        @keyframes screen-appear {
            0% { opacity: 0; transform: translateY(30px) scale(0.95); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        /* Header Styles */
        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: header-float 6s ease-in-out infinite;
        }
        
        @keyframes header-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .logo {
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(90deg, #4CAF50, #2196F3);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 15px;
            letter-spacing: -1px;
        }
        
        .tagline {
            font-size: 20px;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Buttons */
        .btn {
            display: inline-block;
            padding: 16px 32px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(33, 150, 243, 0.2));
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            backdrop-filter: blur(10px);
            text-align: center;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            border: none;
            outline: none;
            min-width: 160px;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(33, 150, 243, 0.3));
            border-color: rgba(76, 175, 80, 0.5);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            border: none;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2196F3, #4CAF50);
            box-shadow: 0 15px 30px rgba(33, 150, 243, 0.4);
        }
        
        /* Glass Cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            width: 100%;
        }
        
        .glass-card:hover {
            transform: translateY(-5px) scale(1.01);
            border-color: rgba(76, 175, 80, 0.4);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        /* Landing Screen */
        .landing-content {
            min-height: 70vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px 20px;
        }
        
        .landing-content h1 {
            font-size: 3rem;
            background: linear-gradient(90deg, #4CAF50, #2196F3, #FFC107);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 2rem;
            line-height: 1.2;
        }
        
        .landing-content p {
            max-width: 700px;
            margin: 0 auto 3rem;
            font-size: 1.2rem;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
        }
        
        /* Lifestyle Input */
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }
        
        .input-card {
            text-align: center;
        }
        
        .input-card h3 {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            color: #4CAF50;
            font-size: 1.3rem;
        }
        
        .slider-container {
            margin: 25px 0;
        }
        
        .slider-value {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #4CAF50;
            text-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            cursor: pointer;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            cursor: pointer;
            border: 3px solid #0f2027;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.8);
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .stress-dots {
            display: flex;
            justify-content: space-between;
            margin: 25px 0;
            gap: 8px;
        }
        
        .stress-dot {
            flex: 1;
            height: 45px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.5);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .stress-dot.active {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.7);
        }
        
        .stress-dot[data-level="1"] { background: rgba(76, 175, 80, 0.2); border-color: #4CAF50; color: #4CAF50; }
        .stress-dot[data-level="2"] { background: rgba(33, 150, 243, 0.2); border-color: #2196F3; color: #2196F3; }
        .stress-dot[data-level="3"] { background: rgba(255, 193, 7, 0.2); border-color: #FFC107; color: #FFC107; }
        .stress-dot[data-level="4"] { background: rgba(244, 67, 54, 0.2); border-color: #F44336; color: #F44336; }
        .stress-dot[data-level="5"] { background: rgba(156, 39, 176, 0.2); border-color: #9C27B0; color: #9C27B0; }
        
        /* Meal Options */
        .meal-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        
        .meal-option {
            text-align: center;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.4s ease;
            padding: 20px 15px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid transparent;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .meal-option:hover {
            background: rgba(76, 175, 80, 0.15);
            border-color: rgba(76, 175, 80, 0.3);
            transform: translateY(-5px);
        }
        
        .meal-option.active {
            background: rgba(76, 175, 80, 0.25);
            border-color: #4CAF50;
            box-shadow: 0 15px 30px rgba(76, 175, 80, 0.3);
        }
        
        .meal-option i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #4CAF50;
        }
        
        /* Analysis Screen */
        .analysis-container {
            min-height: 70vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }
        
        .analysis-ring {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            border: 6px solid rgba(76, 175, 80, 0.2);
            border-top: 6px solid #4CAF50;
            margin: 40px 0;
            animation: spin 2s linear infinite;
            position: relative;
            box-shadow: 0 0 50px rgba(76, 175, 80, 0.4);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Results Dashboard */
        .nutrient-list {
            margin: 40px 0;
        }
        
        .nutrient-item {
            display: flex;
            align-items: center;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.08);
            border-left: 5px solid #4CAF50;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nutrient-item:hover {
            transform: translateX(5px);
            background: rgba(255, 255, 255, 0.12);
        }
        
        .nutrient-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            font-size: 1.8rem;
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }
        
        .nutrient-info {
            flex: 1;
        }
        
        .nutrient-name {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 5px;
            color: #fff;
        }
        
        .nutrient-drift {
            font-size: 1.8rem;
            font-weight: 800;
            margin-left: 15px;
            text-align: right;
            min-width: 70px;
        }
        
        /* Risk Assessment */
        .risk-assessment {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border-radius: 20px;
            padding: 30px;
            margin: 40px 0;
            border: 1px solid rgba(255, 255, 255, 0.15);
            text-align: center;
        }
        
        .risk-level {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 20px 0;
            padding: 15px 30px;
            border-radius: 15px;
            display: inline-block;
        }
        
        .risk-low {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.2), rgba(76, 175, 80, 0.1));
            color: #4CAF50;
            border: 2px solid #4CAF50;
        }
        
        .risk-medium {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.2), rgba(255, 193, 7, 0.1));
            color: #FFC107;
            border: 2px solid #FFC107;
        }
        
        .risk-high {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.2), rgba(244, 67, 54, 0.1));
            color: #F44336;
            border: 2px solid #F44336;
        }
        
        .rating-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            margin: 15px 0;
        }
        
        /* Progress Indicator */
        .progress-indicator {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 30px 0;
        }
        
        .progress-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .progress-dot.active {
            background: #4CAF50;
            transform: scale(1.3);
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.7);
        }
        
        /* Screen Navigation */
        .screen-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            gap: 20px;
        }
        
        /* Action Grid */
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }
        
        .action-card {
            padding: 20px;
            border-radius: 15px;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(33, 150, 243, 0.15));
            border: 1px solid rgba(76, 175, 80, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .action-card h4 {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            color: #4CAF50;
            font-size: 1.1rem;
        }
        
        /* Final Screen */
        .final-content {
            min-height: 70vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
        
        .final-content h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #4CAF50, #2196F3, #FFC107, #9C27B0);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 2rem;
            line-height: 1.3;
        }
        
        .final-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .stat {
            text-align: center;
            min-width: 120px;
        }
        
        .stat-value {
            font-size: 2.8rem;
            font-weight: 800;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* AI Accuracy Indicator */
        .ai-accuracy {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
        }
        
        .accuracy-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(76, 175, 80, 0.9);
            backdrop-filter: blur(20px);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.5s ease;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 90%;
        }
        
        .notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        /* Ripple Effect */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: scale(0);
            animation: ripple-animation 0.6s ease-out;
            pointer-events: none;
        }
        
        @keyframes ripple-animation {
            to { transform: scale(4); opacity: 0; }
        }
        
        /* Profile Screen Styles */
        .history-item:hover {
            background: rgba(76, 175, 80, 0.1) !important;
            transform: translateX(5px);
        }

        .empty-state i {
            animation: pulse 2s infinite;
        }

        /* Ensure input fields are styled properly */
        input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        input:focus {
            outline: none;
            border-color: #4CAF50 !important;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
        }
        
        /* AI Confidence Indicator */
        .confidence-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 10px;
        }
        
        .confidence-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .confidence-high { background: #4CAF50; }
        .confidence-medium { background: #FFC107; }
        .confidence-low { background: #F44336; }
        
        /* Future Consequence Box */
        .consequence-box {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.1), rgba(244, 67, 54, 0.05));
            border: 1px solid rgba(244, 67, 54, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .consequence-box.green {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05));
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .consequence-box.orange {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 193, 7, 0.05));
            border: 1px solid rgba(255, 193, 7, 0.3);
        }
        
        /* Trend Chart */
        .trend-chart {
            display: flex;
            align-items: flex-end;
            height: 100px;
            gap: 10px;
            margin: 20px 0;
        }
        
        .trend-bar {
            flex: 1;
            background: linear-gradient(to top, #4CAF50, #2196F3);
            border-radius: 4px 4px 0 0;
            min-height: 5px;
            transition: height 0.5s ease;
        }
        
        /* What-If Simulation */
        .what-if-simulation {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(33, 150, 243, 0.05));
            border: 1px solid rgba(33, 150, 243, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .what-if-controls {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .what-if-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .what-if-btn:hover {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4CAF50;
        }
        
        /* Problem Explanation Card */
        .problem-card {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.1), rgba(156, 39, 176, 0.05));
            border: 1px solid rgba(156, 39, 176, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
        }
        
        /* Nutrient Status Badges */
        .nutrient-status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .status-low { background: rgba(76, 175, 80, 0.2); color: #4CAF50; }
        .status-medium { background: rgba(255, 193, 7, 0.2); color: #FFC107; }
        .status-high { background: rgba(244, 67, 54, 0.2); color: #F44336; }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-layout {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                position: static;
                height: auto;
                padding: 20px;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .background-effects,
            .nutrient-particles {
                left: 0;
                width: 100%;
            }
            
            .nav-menu {
                flex-direction: row;
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .nav-item {
                flex: 1;
                min-width: 120px;
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .nav-item i {
                font-size: 18px;
            }
        }
        
        @media (max-width: 768px) {
            .landing-content h1 {
                font-size: 2.2rem;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .meal-options {
                grid-template-columns: 1fr;
            }
            
            .action-grid {
                grid-template-columns: 1fr;
            }
            
            .screen-nav {
                flex-direction: column;
            }
            
            .final-stats {
                gap: 30px;
            }
            
            .stat-value {
                font-size: 2.2rem;
            }
            
            .risk-level {
                font-size: 1.8rem;
                padding: 12px 20px;
            }
            
            .what-if-controls {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .landing-content h1 {
                font-size: 1.8rem;
            }
            
            .logo {
                font-size: 36px;
            }
            
            .tagline {
                font-size: 16px;
            }
            
            .nav-item {
                min-width: 100px;
                font-size: 12px;
                padding: 10px 12px;
            }
            
            .nav-item i {
                font-size: 16px;
            }
            
            .btn {
                padding: 14px 24px;
                font-size: 14px;
                min-width: 140px;
            }
        }
        
        /* Disclaimer */
        .disclaimer {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.5;
        }
        
        /* Sound Visualizer */
        .sound-visualizer {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 200px;
            height: 50px;
            z-index: 999;
            opacity: 0.7;
        }
        
        .sound-bar {
            position: absolute;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to top, #4CAF50, #2196F3);
            border-radius: 2px 2px 0 0;
            animation: sound-bar-animation 0.5s infinite alternate;
        }
        
        @keyframes sound-bar-animation {
            0% { height: 5%; }
            100% { height: 100%; }
        }
        
        /* Detail Panel */
        .detail-panel {
            position: fixed;
            bottom: 0;
            left: 280px;
            right: 0;
            background: rgba(15, 32, 39, 0.98);
            backdrop-filter: blur(30px);
            border-top: 1px solid rgba(76, 175, 80, 0.3);
            padding: 40px;
            transform: translateY(100%);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2000;
            border-radius: 40px 40px 0 0;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 -20px 50px rgba(0, 0, 0, 0.5);
        }
        
        .detail-panel.active {
            transform: translateY(0);
        }
        
        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .close-detail {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 2rem;
            cursor: pointer;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-detail:hover {
            background: rgba(76, 175, 80, 0.3);
            color: #4CAF50;
            transform: rotate(90deg);
        }
        
        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 40px 0;
        }
        
        .dashboard-card {
            padding: 25px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
        
        .dashboard-card i {
            font-size: 2.5rem;
            color: #4CAF50;
            margin-bottom: 15px;
        }
        
        /* Wave Patterns */
        .wave-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 100px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="rgba(76, 175, 80, 0.1)" d="M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,218.7C672,235,768,245,864,234.7C960,224,1056,192,1152,181.3C1248,171,1344,181,1392,186.7L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
            background-size: 50% 100px;
            animation: wave-motion 20s linear infinite;
        }
        
        .wave:nth-child(2) {
            bottom: 10px;
            opacity: 0.5;
            animation: wave-motion 15s linear infinite reverse;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org2000/svg" viewBox="0 0 1440 320"><path fill="rgba(33, 150, 243, 0.1)" d="M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,218.7C672,235,768,245,864,234.7C960,224,1056,192,1152,181.3C1248,171,1344,181,1392,186.7L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
        }
        
        .wave:nth-child(3) {
            bottom: 20px;
            opacity: 0.3;
            animation: wave-motion 25s linear infinite;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="rgba(255, 193, 7, 0.1)" d="M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,218.7C672,235,768,245,864,234.7C960,224,1056,192,1152,181.3C1248,171,1344,181,1392,186.7L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
        }
        
        @keyframes wave-motion {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        /* Pulsing Orbs */
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(20px);
            animation: orb-pulse 10s infinite ease-in-out;
        }
        
        @keyframes orb-pulse {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.2); opacity: 0.6; }
        }
        
        /* Light Rays */
        .light-ray {
            position: absolute;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0));
            transform-origin: top center;
            animation: ray-pulse 8s infinite ease-in-out;
        }
        
        @keyframes ray-pulse {
            0%, 100% { opacity: 0.1; transform: scaleX(1); }
            50% { opacity: 0.3; transform: scaleX(1.2); }
        }
    </style>
</head>
<body>
    <!-- Main Layout -->
    <div class="main-layout">
        <!-- Left Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">NutrientDriftAI</div>
                <div class="sidebar-tagline">Personal AI Nutrition Analyst</div>
            </div>
            
            <nav class="nav-menu">
                <a class="nav-item active" data-screen="dashboard">
                    <i class="material-icons">dashboard</i>
                    <span>Dashboard</span>
                </a>
                <a class="nav-item" data-screen="lifestyle">
                    <i class="material-icons">fitness_center</i>
                    <span>Lifestyle Input</span>
                </a>
                <a class="nav-item" data-screen="meal">
                    <i class="material-icons">restaurant</i>
                    <span>Meal Input</span>
                </a>
                <a class="nav-item" data-screen="analysis">
                    <i class="material-icons">insights</i>
                    <span>AI Analysis</span>
                </a>
                <a class="nav-item" data-screen="results">
                    <i class="material-icons">bar_chart</i>
                    <span>Nutrient Results</span>
                </a>
                <a class="nav-item" data-screen="actions">
                    <i class="material-icons">lightbulb</i>
                    <span>Action Plan</span>
                </a>
                <a class="nav-item" data-screen="final">
                    <i class="material-icons">emoji_events</i>
                    <span>Final Report</span>
                </a>
                <a class="nav-item" data-screen="profile">
                    <i class="material-icons">account_circle</i>
                    <span>Profile & Results</span>
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <p>Â© 2024 NutrientDriftAI</p>
                <p>AI-Powered Nutrition Analysis</p>
            </div>
        </aside>
        
        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Sound Controls -->
            <div class="sound-controls">
                <button class="sound-btn active" id="sound-toggle">
                    <i class="material-icons">volume_up</i>
                </button>
                <button class="sound-btn" id="music-toggle">
                    <i class="material-icons">music_note</i>
                </button>
            </div>
            
            <!-- Sound Visualizer -->
            <div class="sound-visualizer" id="sound-visualizer"></div>
            
            <!-- Notification -->
            <div class="notification" id="notification">
                <i class="material-icons">info</i>
                <span id="notification-text">Welcome to NutrientDriftAI!</span>
            </div>
            
            <!-- Background Effects -->
            <div class="background-effects">
                <div class="animated-gradient"></div>
                
                <!-- Geometric Shapes -->
                <div class="geometric-shape shape-circle" style="width: 120px; height: 120px; top: 10%; left: 20%;"></div>
                <div class="geometric-shape shape-circle" style="width: 80px; height: 80px; top: 70%; left: 80%;"></div>
                <div class="geometric-shape shape-circle" style="width: 60px; height: 60px; top: 40%; left: 60%;"></div>
                
                <!-- Light Rays -->
                <div class="light-ray" style="width: 3px; height: 400px; top: 0; left: 15%; transform: rotate(15deg);"></div>
                <div class="light-ray" style="width: 3px; height: 500px; top: 0; left: 35%; transform: rotate(-10deg);"></div>
                <div class="light-ray" style="width: 3px; height: 450px; top: 0; left: 55%; transform: rotate(20deg);"></div>
                
                <!-- Wave Patterns -->
                <div class="wave-container">
                    <div class="wave"></div>
                    <div class="wave"></div>
                    <div class="wave"></div>
                </div>
                
                <!-- Pulsing Orbs -->
                <div class="orb" style="width: 250px; height: 250px; top: -50px; left: -50px; background: radial-gradient(circle, rgba(76, 175, 80, 0.4), transparent);"></div>
                <div class="orb" style="width: 180px; height: 180px; top: 50%; right: -50px; background: radial-gradient(circle, rgba(33, 150, 243, 0.4), transparent);"></div>
            </div>
            
            <!-- Nutrient Particles -->
            <div class="nutrient-particles" id="nutrient-particles"></div>
            
            <!-- App Container -->
            <div class="app-container">
                <!-- Progress Indicator -->
                <div class="progress-indicator" id="progress-indicator"></div>
                
                <!-- Screen 1: Dashboard -->
                <div class="screen active" id="screen-dashboard">
                    <div class="header">
                        <div class="logo">NutrientDriftAI</div>
                        <div class="tagline">Your Personal AI Nutrition Analyst</div>
                    </div>
                    
                    <!-- Problem Explanation Card -->
                    <div class="problem-card">
                        <h3><i class="material-icons">lightbulb</i> What is Nutrient Drift?</h3>
                        <p>When lifestyle stress increases nutrient demand faster than diet adapts, hidden deficiencies begin. NutrientDriftAI detects the gap between what you consume and what your modern life requires.</p>
                    </div>
                    
                    <div class="dashboard-grid">
                        <div class="glass-card dashboard-card">
                            <i class="material-icons">insights</i>
                            <h3>AI Nutrient Analysis</h3>
                            <p>Get personalized nutrient drift analysis based on your lifestyle and diet</p>
                            <button class="btn btn-primary" id="start-from-dashboard" style="margin-top: 20px;">
                                Start Analysis
                            </button>
                        </div>
                        
                        <div class="glass-card dashboard-card">
                            <i class="material-icons">monitor_heart</i>
                            <h3>Risk Assessment</h3>
                            <p>Discover your nutrient deficiency risk level and get personalized recommendations</p>
                        </div>
                        
                        <div class="glass-card dashboard-card">
                            <i class="material-icons">restaurant</i>
                            <h3>Meal Planning</h3>
                            <p>Get AI-powered meal suggestions based on your nutrient needs</p>
                        </div>
                        
                        <div class="glass-card dashboard-card">
                            <i class="material-icons">trending_up</i>
                            <h3>Progress Tracking</h3>
                            <p>Track your nutrient improvement over time with detailed analytics</p>
                        </div>
                    </div>
                    
                    <!-- Trend History -->
                    <div class="glass-card" style="margin-top: 40px;">
                        <h3><i class="material-icons">timeline</i> Your Nutrient Trend (Last 7 Days)</h3>
                        <div id="trend-history" class="trend-chart">
                            <!-- Trend bars will be loaded here dynamically -->
                        </div>
                        <p style="text-align: center; color: rgba(255,255,255,0.7); font-size: 0.9rem; margin-top: 10px;">
                            <i class="material-icons" style="font-size: 1rem; vertical-align: middle;">info</i>
                            Based on your analysis history (simulated for demo)
                        </p>
                    </div>
                    
                    <div class="risk-assessment" style="margin-top: 40px;">
                        <h3>Start Your Nutrient Journey</h3>
                        <p>Begin by analyzing your current nutrient status based on your lifestyle factors. Our AI will identify hidden nutrient gaps you might not be aware of.</p>
                        <button class="btn btn-primary" id="start-analysis-btn" style="margin-top: 20px;">
                            <i class="material-icons">play_arrow</i> Start 2-Minute Analysis
                        </button>
                    </div>
                </div>
                
                <!-- Screen 2: Lifestyle Input -->
                <div class="screen" id="screen-lifestyle">
                    <div class="header">
                        <h2>Lifestyle Input</h2>
                        <p class="tagline">Tell us about your daily habits to calculate your unique nutrient demands</p>
                    </div>
                    
                    <div class="input-grid">
                        <!-- Sleep Card -->
                        <div class="glass-card input-card">
                            <h3><i class="material-icons">bed</i> Sleep Quality</h3>
                            <p>How many hours do you typically sleep per night?</p>
                            <div class="slider-container">
                                <div class="slider-value" id="sleep-value">7</div>
                                <input type="range" min="4" max="9" value="7" class="slider" id="sleep-slider" step="0.5">
                                <div class="slider-labels">
                                    <span>4h (Poor)</span>
                                    <span>9h (Excellent)</span>
                                </div>
                            </div>
                            <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-top: 10px;">
                                <i class="material-icons" style="font-size: 1rem; vertical-align: middle;">info</i>
                                Less than 6h increases nutrient depletion by 30-50%
                            </p>
                        </div>
                        
                        <!-- Screen Time Card -->
                        <div class="glass-card input-card">
                            <h3><i class="material-icons">desktop_windows</i> Screen Time</h3>
                            <p>Daily hours spent on digital screens (work + leisure)</p>
                            <div class="slider-container">
                                <div class="slider-value" id="screen-value">6</div>
                                <input type="range" min="1" max="16" value="6" class="slider" id="screen-slider">
                                <div class="slider-labels">
                                    <span>1h</span>
                                    <span>16h</span>
                                </div>
                            </div>
                            <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-top: 10px;">
                                <i class="material-icons" style="font-size: 1rem; vertical-align: middle;">info</i>
                                Over 8h significantly increases eye nutrient demands
                            </p>
                        </div>
                        
                        <!-- Stress Card -->
                        <div class="glass-card input-card">
                            <h3><i class="material-icons">psychology</i> Stress Level</h3>
                            <p>Select your average daily stress perception</p>
                            <div class="stress-dots">
                                <div class="stress-dot" data-level="1" data-label="Low">Low</div>
                                <div class="stress-dot" data-level="2" data-label="Moderate">Moderate</div>
                                <div class="stress-dot active" data-level="3" data-label="High">High</div>
                                <div class="stress-dot" data-level="4" data-label="Very High">Very High</div>
                                <div class="stress-dot" data-level="5" data-label="Extreme">Extreme</div>
                            </div>
                            <div class="slider-labels" style="margin-top: 10px;">
                                <span>Low</span>
                                <span>Moderate</span>
                                <span>High</span>
                                <span>Very High</span>
                                <span>Extreme</span>
                            </div>
                            <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-top: 10px;">
                                <i class="material-icons" style="font-size: 1rem; vertical-align: middle;">info</i>
                                High stress depletes magnesium & B vitamins faster
                            </p>
                        </div>
                        
                        <!-- Activity Card -->
                        <div class="glass-card input-card">
                            <h3><i class="material-icons">directions_run</i> Activity Level</h3>
                            <p>How intense is your daily physical activity?</p>
                            <div class="slider-container">
                                <div class="slider-value" id="activity-value">Moderate</div>
                                <input type="range" min="1" max="5" value="3" class="slider" id="activity-slider">
                                <div class="slider-labels">
                                    <span>Sedentary</span>
                                    <span>Very Active</span>
                                </div>
                            </div>
                            <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-top: 10px;">
                                <i class="material-icons" style="font-size: 1rem; vertical-align: middle;">info</i>
                                High activity increases iron & magnesium needs by 20-40%
                            </p>
                        </div>
                    </div>
                    
                    <div class="screen-nav">
                        <button class="btn" id="back-to-dashboard-from-lifestyle">
                            <i class="material-icons">arrow_back</i> Back to Dashboard
                        </button>
                        <button class="btn btn-primary" id="to-meal">
                            Continue to Meal Input
                        </button>
                    </div>
                </div>
                
                <!-- Screen 3: Meal Input -->
                <div class="screen" id="screen-meal">
                    <div class="header">
                        <h2>Meal Input (Optional)</h2>
                        <p class="tagline">Help us understand your current nutrient intake for better accuracy</p>
                    </div>
                    
                    <div class="meal-options">
                        <div class="glass-card meal-option active" data-meal="typical">
                            <i class="material-icons">restaurant</i>
                            <h3>Typical Diet</h3>
                            <p>I eat a balanced diet with fruits, vegetables, and proteins</p>
                            <div class="confidence-indicator" style="margin-top: 15px;">
                                <span>Baseline nutrient coverage: 70-85%</span>
                            </div>
                        </div>
                        
                        <div class="glass-card meal-option" data-meal="processed">
                            <i class="material-icons">fastfood</i>
                            <h3>Processed Foods</h3>
                            <p>My diet includes packaged/processed foods regularly</p>
                            <div class="confidence-indicator" style="margin-top: 15px;">
                                <span>Nutrient coverage: 50-65% (lower in key micronutrients)</span>
                            </div>
                        </div>
                        
                        <div class="glass-card meal-option" data-meal="vegetarian">
                            <i class="material-icons">eco</i>
                            <h3>Vegetarian</h3>
                            <p>I don't eat meat but consume dairy and eggs</p>
                            <div class="confidence-indicator" style="margin-top: 15px;">
                                <span>May need more iron, zinc, B12 (30% lower bioavailability)</span>
                            </div>
                        </div>
                        
                        <div class="glass-card meal-option" data-meal="vegan">
                            <i class="material-icons">spa</i>
                            <h3>Vegan</h3>
                            <p>I don't consume any animal products</p>
                            <div class="confidence-indicator" style="margin-top: 15px;">
                                <span>Requires careful planning for B12, iron, omega-3</span>
                            </div>
                        </div>
                        
                        <div class="glass-card skip-option" style="grid-column: 1 / -1; text-align: center; padding: 25px; margin-top: 10px;">
                            <p>Prefer to skip meal input? We'll use standard RDA values and focus on lifestyle-based nutrient demand.</p>
                            <button class="btn" id="skip-meal" style="margin-top: 15px;">Skip Meal Input</button>
                        </div>
                    </div>
                    
                    <div class="what-if-simulation">
                        <h3><i class="material-icons">science</i> What-If Simulation</h3>
                        <p>See how different meal choices affect your nutrient drift:</p>
                        <div class="what-if-controls">
                            <button class="what-if-btn" data-change="more_veggies">+ Add More Vegetables</button>
                            <button class="what-if-btn" data-change="less_processed">- Reduce Processed Foods</button>
                            <button class="what-if-btn" data-change="add_fish">+ Add Fish Twice Weekly</button>
                            <button class="what-if-btn" data-change="add_nuts">+ Add Nuts Daily</button>
                        </div>
                        <div id="what-if-result" style="display: none; margin-top: 15px; padding: 15px; background: rgba(76,175,80,0.1); border-radius: 10px;">
                            <p>This change could reduce your nutrient drift by <strong>15-25%</strong></p>
                        </div>
                    </div>
                    
                    <div class="screen-nav">
                        <button class="btn" id="back-to-lifestyle">
                            <i class="material-icons">arrow_back</i> Back
                        </button>
                        <button class="btn btn-primary" id="to-analysis">
                            Analyze My Nutrient Drift
                        </button>
                    </div>
                </div>
                
                <!-- Screen 4: Analysis -->
                <div class="screen" id="screen-analysis">
                    <div class="analysis-container">
                        <h2>Analyzing Nutrient Drift</h2>
                        <p>Calculating the delta between your lifestyle demands and nutrient intake...</p>
                        
                        <div class="analysis-ring">
                            <div class="ring-inner" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2rem; font-weight: 700; color: #4CAF50;">AI</div>
                        </div>
                        
                        <p id="analysis-text">Initializing neural network analysis...</p>
                        
                        <div class="ai-accuracy">
                            <div class="accuracy-dot"></div>
                            <span>AI analyzing 180+ biochemical correlations</span>
                        </div>
                        
                        <div class="confidence-indicator" style="margin-top: 20px;">
                            <span>AI Confidence Level:</span>
                            <div class="confidence-bar">
                                <div class="confidence-fill confidence-medium" id="confidence-fill" style="width: 85%;"></div>
                            </div>
                            <span id="confidence-text">High (85%)</span>
                        </div>
                    </div>
                </div>
                
                <!-- Screen 5: Results Dashboard -->
                <div class="screen" id="screen-results">
                    <div class="header">
                        <h2>Your Nutrient Drift Analysis</h2>
                        <p class="tagline">Personalized nutrient analysis based on your lifestyle factors</p>
                    </div>
                    
                    <!-- AI Confidence Indicator -->
                    <div class="ai-accuracy">
                        <div class="accuracy-dot"></div>
                        <span>AI Confidence: 85% based on clinical research data patterns</span>
                    </div>
                    
                    <!-- Risk Assessment Section -->
                    <div class="risk-assessment">
                        <h3>Your Health Risk Assessment</h3>
                        <div class="rating-badge">
                            <i class="material-icons">star</i>
                            <span>Based on your inputs, your risk level is:</span>
                        </div>
                        <div class="risk-level" id="risk-level">
                            <!-- Risk level will be dynamically set -->
                        </div>
                        <p id="risk-description">
                            <!-- Risk description will be dynamically set -->
                        </p>
                        
                        <div class="confidence-indicator" style="margin-top: 20px; justify-content: center;">
                            <span>Assessment Confidence:</span>
                            <div class="confidence-bar" style="width: 100px;">
                                <div class="confidence-fill confidence-high" id="assessment-confidence" style="width: 90%;"></div>
                            </div>
                            <span>90%</span>
                        </div>
                    </div>
                    
                    <!-- What-If Quick Actions -->
                    <div class="what-if-simulation">
                        <h3><i class="material-icons">bolt</i> Quick Improvement Actions</h3>
                        <p>See how small changes affect your nutrient drift:</p>
                        <div class="what-if-controls">
                            <button class="what-if-btn" id="what-if-sleep">+1 Hour Sleep</button>
                            <button class="what-if-btn" id="what-if-screen">-2 Hours Screen</button>
                            <button class="what-if-btn" id="what-if-stress">Reduce Stress 1 Level</button>
                            <button class="what-if-btn" id="what-if-veggies">+2 Servings Veggies</button>
                        </div>
                        <div id="quick-improvement-result" style="display: none; margin-top: 15px; padding: 15px; background: rgba(76,175,80,0.1); border-radius: 10px;">
                            <p id="improvement-text"></p>
                        </div>
                    </div>
                    
                    <!-- Nutrient List -->
                    <h3 style="margin-top: 40px; margin-bottom: 20px;">Your Nutrient Drift Analysis</h3>
                    <div class="nutrient-list" id="nutrient-list">
                        <!-- Nutrients will be loaded here dynamically -->
                    </div>
                    
                    <div class="screen-nav">
                        <button class="btn" id="back-to-analysis-from-results">
                            <i class="material-icons">arrow_back</i> Back
                        </button>
                        <button class="btn btn-primary" id="to-actions">
                            See Action Plan
                        </button>
                    </div>
                </div>
                
                <!-- Screen 6: Actions -->
                <div class="screen" id="screen-actions">
                    <div class="header">
                        <h2>Personalized Action Plan</h2>
                        <p class="tagline">Simple, non-clinical adjustments to address your specific nutrient drift</p>
                    </div>
                    
                    <div class="action-grid" id="action-grid">
                        <!-- Action cards will be loaded here dynamically -->
                    </div>
                    
                    <div class="screen-nav">
                        <button class="btn" id="back-to-results">
                            <i class="material-icons">arrow_back</i> Back
                        </button>
                        <button class="btn btn-primary" id="to-final">
                            See Final Report
                        </button>
                    </div>
                </div>
                
                <!-- Screen 7: Final -->
                <div class="screen" id="screen-final">
                    <div class="final-content">
                        <h1>Most nutrition apps plan meals.<br>We detect nutrient drift.</h1>
                        <p>Your lifestyle creates unique biochemical demands that standard nutrition guidelines don't account for. NutrientDriftAI identifies the gap between what you consume and what your modern life requires.</p>
                        
                        <div class="final-stats">
                            <div class="stat">
                                <div class="stat-value" id="stat-discovered">92%</div>
                                <div class="stat-label">Users discover at least one nutrient gap</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="stat-improvement">2.4x</div>
                                <div class="stat-label">Higher magnesium demand with high screen time</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="stat-confidence">85%</div>
                                <div class="stat-label">AI confidence in nutrient drift detection</div>
                            </div>
                        </div>
                        
                        <!-- Trend Visualization -->
                        <div class="glass-card" style="max-width: 600px; margin: 40px auto;">
                            <h3><i class="material-icons">trending_up</i> Your Improvement Potential</h3>
                            <div class="trend-chart" style="height: 80px;">
                                <div class="trend-bar" id="trend-current" style="height: 70%; background: linear-gradient(to top, #F44336, #FFC107);"></div>
                                <div class="trend-bar" id="trend-potential" style="height: 30%; background: linear-gradient(to top, #4CAF50, #2196F3);"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                                <span style="color: #FFC107;">Current Drift</span>
                                <span style="color: #4CAF50;">Potential with Changes</span>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" id="restart">
                            Start New Analysis
                        </button>
                        
                        <!-- Save Results Prompt -->
                        <div style="margin-top: 30px;">
                            <p style="color: rgba(255,255,255,0.7);">Save this analysis to track your progress over time.</p>
                            <button class="btn" id="save-final-analysis" style="margin-top: 10px;">
                                <i class="material-icons">save</i> Save Analysis to History
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Screen 8: Profile & Results Storage -->
                <div class="screen" id="screen-profile">
                    <div class="header">
                        <h2>Profile & Analysis History</h2>
                        <p class="tagline">Manage your personal information and view past analysis results</p>
                    </div>
                    
                    <div class="input-grid">
                        <!-- Personal Information Card -->
                        <div class="glass-card input-card">
                            <h3><i class="material-icons">person</i> Personal Information</h3>
                            <div style="margin-top: 20px;">
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; color: rgba(255, 255, 255, 0.8);">Full Name</label>
                                    <input type="text" id="user-name" placeholder="Enter your name" 
                                           style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); 
                                                  border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; 
                                                  color: white; font-size: 16px;">
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; color: rgba(255, 255, 255, 0.8);">Age</label>
                                    <input type="number" id="user-age" placeholder="Age" min="18" max="100"
                                           style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); 
                                                  border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; 
                                                  color: white; font-size: 16px;">
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 5px; color: rgba(255, 255, 255, 0.8);">Email</label>
                                    <input type="email" id="user-email" placeholder="email@example.com"
                                           style="width: 100%; padding: 12px; background: rgba(255,255,255,0.1); 
                                                  border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; 
                                                  color: white; font-size: 16px;">
                                </div>
                                <button class="btn" id="save-profile" style="margin-top: 20px; width: 100%;">
                                    <i class="material-icons">save</i> Save Profile
                                </button>
                            </div>
                        </div>
                        
                        <!-- Saved Results Card -->
                        <div class="glass-card input-card">
                            <h3><i class="material-icons">history</i> Analysis History</h3>
                            <div id="saved-results" style="margin-top: 20px; max-height: 300px; overflow-y: auto;">
                                <div class="empty-state" style="text-align: center; padding: 30px; color: rgba(255,255,255,0.5);">
                                    <i class="material-icons" style="font-size: 48px; margin-bottom: 15px;">folder_open</i>
                                    <p>No saved analyses yet. Complete your first analysis to see it here.</p>
                                </div>
                            </div>
                            <button class="btn" id="clear-history" style="margin-top: 15px; width: 100%;">
                                <i class="material-icons">delete</i> Clear History
                            </button>
                        </div>
                    </div>
                    
                    <!-- Current Analysis Summary -->
                    <div class="glass-card" style="margin-top: 30px;">
                        <h3><i class="material-icons">cloud_download</i> Export Analysis</h3>
                        <p>Save or export your current analysis results for future reference.</p>
                        <div style="display: flex; gap: 15px; margin-top: 20px;">
                            <button class="btn" id="save-current-analysis">
                                <i class="material-icons">save_alt</i> Save Current Analysis
                            </button>
                            <button class="btn" id="export-pdf">
                                <i class="material-icons">picture_as_pdf</i> Export as PDF
                            </button>
                            <button class="btn" id="export-csv">
                                <i class="material-icons">table_chart</i> Export Data
                            </button>
                        </div>
                    </div>
                    
                    <div class="screen-nav">
                        <button class="btn" id="back-to-dashboard-from-profile">
                            <i class="material-icons">arrow_back</i> Back to Dashboard
                        </button>
                    </div>
                </div>
                
                <!-- Nutrient Detail Panel -->
                <div class="detail-panel" id="detail-panel">
                    <div class="detail-header">
                        <h2 id="detail-title">Nutrient Details</h2>
                        <button class="close-detail" id="close-detail"><i class="material-icons">close</i></button>
                    </div>
                    <div id="detail-content">
                        <!-- Content loaded dynamically -->
                    </div>
                </div>
                
                <!-- Enhanced Disclaimer -->
                <div class="disclaimer">
                    <p><i class="material-icons">medical_services</i> <strong>Important Notice:</strong> NutrientDriftAI provides nutritional insights based on lifestyle-nutrient correlations and is not medical advice. Estimates are based on lifestyle patterns and research data. Consult a healthcare professional for medical concerns or diagnoses.</p>
                    <p style="margin-top: 10px; font-size: 0.8rem; color: rgba(255,255,255,0.5);">
                        This tool helps identify potential nutrient gaps but does not diagnose deficiencies. Results should be used as guidance for lifestyle improvements, not as medical treatment recommendations.
                    </p>
                </div>
            </div>
        </main>
    </div>

    <!-- COMPLETE JavaScript Code with Real AI Logic -->
    <script>
        // Sound Manager
        class SoundManager {
            constructor() {
                this.soundsEnabled = true;
                this.musicEnabled = false;
                this.audioContext = null;
                this.initAudioContext();
            }
            
            initAudioContext() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log("Web Audio API not supported");
                }
            }
            
            playClick() {
                if (!this.soundsEnabled || !this.audioContext) return;
                
                try {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(800, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(400, this.audioContext.currentTime + 0.1);
                    
                    gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.2);
                    
                    oscillator.start();
                    oscillator.stop(this.audioContext.currentTime + 0.2);
                } catch (e) {
                    console.log("Sound error:", e);
                }
            }
            
            playTransition() {
                if (!this.soundsEnabled || !this.audioContext) return;
                
                try {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(200, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(800, this.audioContext.currentTime + 0.5);
                    
                    gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.6);
                    
                    oscillator.start();
                    oscillator.stop(this.audioContext.currentTime + 0.6);
                } catch (e) {
                    console.log("Sound error:", e);
                }
            }
            
            playSuccess() {
                if (!this.soundsEnabled || !this.audioContext) return;
                
                try {
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(523.25, this.audioContext.currentTime);
                    oscillator.frequency.setValueAtTime(659.25, this.audioContext.currentTime + 0.1);
                    oscillator.frequency.setValueAtTime(783.99, this.audioContext.currentTime + 0.2);
                    
                    gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                    
                    oscillator.start();
                    oscillator.stop(this.audioContext.currentTime + 0.5);
                } catch (e) {
                    console.log("Sound error:", e);
                }
            }
            
            toggleSounds() {
                this.soundsEnabled = !this.soundsEnabled;
                this.showNotification(this.soundsEnabled ? "Sound effects enabled" : "Sound effects disabled");
                return this.soundsEnabled;
            }
            
            toggleMusic() {
                this.musicEnabled = !this.musicEnabled;
                this.showNotification(this.musicEnabled ? "Background music enabled" : "Background music disabled");
                return this.musicEnabled;
            }
            
            showNotification(text) {
                const notification = document.getElementById('notification');
                const textElement = document.getElementById('notification-text');
                
                if (!notification || !textElement) return;
                
                textElement.textContent = text;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }

        // REAL AI ANALYSIS ENGINE
        class NutrientAI {
            constructor() {
                this.nutrientDatabase = {
                    magnesium: { 
                        rda: 400, key: 'mg', color: '#4CAF50',
                        functions: ['Energy production', 'Muscle function', 'Nerve signaling', 'Blood pressure regulation'],
                        sources: ['Spinach', 'Almonds', 'Avocado', 'Dark chocolate'],
                        deficiencySymptoms: ['Muscle cramps', 'Fatigue', 'Insomnia', 'Anxiety'],
                        icon: 'bolt',
                        impactFactors: []
                    },
                    vitaminD: { 
                        rda: 600, key: 'IU', color: '#2196F3',
                        functions: ['Bone health', 'Immune function', 'Calcium absorption', 'Mood regulation'],
                        sources: ['Sunlight', 'Fatty fish', 'Egg yolks', 'Fortified milk'],
                        deficiencySymptoms: ['Fatigue', 'Bone pain', 'Depression', 'Hair loss'],
                        icon: 'wb_sunny',
                        impactFactors: []
                    },
                    omega3: { 
                        rda: 1.6, key: 'g', color: '#FFC107',
                        functions: ['Brain health', 'Anti-inflammatory', 'Heart health', 'Eye health'],
                        sources: ['Fatty fish', 'Walnuts', 'Chia seeds', 'Flaxseeds'],
                        deficiencySymptoms: ['Dry skin', 'Mood swings', 'Poor memory', 'Joint pain'],
                        icon: 'waves',
                        impactFactors: []
                    },
                    iron: { 
                        rda: 18, key: 'mg', color: '#F44336',
                        functions: ['Oxygen transport', 'Energy production', 'Immune function', 'Cognitive development'],
                        sources: ['Red meat', 'Lentils', 'Spinach', 'Tofu'],
                        deficiencySymptoms: ['Fatigue', 'Pale skin', 'Shortness of breath', 'Headaches'],
                        icon: 'opacity',
                        impactFactors: []
                    },
                    vitaminC: { 
                        rda: 90, key: 'mg', color: '#E91E63',
                        functions: ['Immune support', 'Collagen production', 'Antioxidant', 'Wound healing'],
                        sources: ['Citrus fruits', 'Bell peppers', 'Strawberries', 'Broccoli'],
                        deficiencySymptoms: ['Fatigue', 'Bleeding gums', 'Slow healing', 'Dry skin'],
                        icon: 'spa',
                        impactFactors: []
                    },
                    zinc: {
                        rda: 11, key: 'mg', color: '#9C27B0',
                        functions: ['Immune function', 'Wound healing', 'DNA synthesis', 'Taste perception'],
                        sources: ['Oysters', 'Beef', 'Pumpkin seeds', 'Lentils'],
                        deficiencySymptoms: ['Hair loss', 'Diarrhea', 'Eye/skin lesions', 'Weight loss'],
                        icon: 'ac_unit',
                        impactFactors: []
                    },
                    bComplex: {
                        rda: 100, key: '%', color: '#FF9800',
                        functions: ['Energy metabolism', 'Nerve function', 'Red blood cell production', 'DNA synthesis'],
                        sources: ['Whole grains', 'Eggs', 'Legumes', 'Leafy greens'],
                        deficiencySymptoms: ['Fatigue', 'Mood changes', 'Skin issues', 'Digestive problems'],
                        icon: 'battery_full',
                        impactFactors: []
                    }
                };
                
                // Meal type nutrient impact mapping
                this.mealImpactMap = {
                    typical: {
                        magnesium: 0.9,    // 90% coverage
                        vitaminD: 0.7,     // 70% coverage
                        omega3: 0.8,
                        iron: 0.85,
                        vitaminC: 0.9,
                        zinc: 0.8,
                        bComplex: 0.85
                    },
                    processed: {
                        magnesium: 0.6,    // 60% coverage
                        vitaminD: 0.4,
                        omega3: 0.5,
                        iron: 0.7,
                        vitaminC: 0.6,
                        zinc: 0.65,
                        bComplex: 0.6
                    },
                    vegetarian: {
                        magnesium: 0.85,
                        vitaminD: 0.6,
                        omega3: 0.7,
                        iron: 0.7,        // Lower bioavailability
                        vitaminC: 0.95,
                        zinc: 0.7,        // Lower bioavailability
                        bComplex: 0.9
                    },
                    vegan: {
                        magnesium: 0.8,
                        vitaminD: 0.4,
                        omega3: 0.6,
                        iron: 0.65,
                        vitaminC: 0.9,
                        zinc: 0.65,
                        bComplex: 0.8
                    }
                };
            }
            
            // REAL AI LOGIC FUNCTION
            analyzeNutrientDrift(lifestyleData, mealType) {
                const results = {};
                const mealImpact = this.mealImpactMap[mealType] || this.mealImpactMap.typical;
                
                // Calculate for each nutrient
                for (const [nutrient, data] of Object.entries(this.nutrientDatabase)) {
                    let driftPercent = 0;
                    let impactFactors = [];
                    let confidence = 0.85; // Base confidence
                    
                    // 1. SLEEP IMPACT (Rule-based logic)
                    if (lifestyleData.sleep < 6) {
                        if (nutrient === 'magnesium') {
                            driftPercent += 35;
                            impactFactors.push(`Poor sleep (${lifestyleData.sleep}h): Magnesium depletion increases by 35%`);
                        }
                        if (nutrient === 'bComplex') {
                            driftPercent += 25;
                            impactFactors.push(`Poor sleep: B vitamin turnover increases by 25%`);
                        }
                        if (nutrient === 'vitaminC') {
                            driftPercent += 20;
                            impactFactors.push(`Inadequate sleep: Antioxidant demand increases by 20%`);
                        }
                        confidence -= 0.05;
                    } else if (lifestyleData.sleep < 7) {
                        if (nutrient === 'magnesium' || nutrient === 'bComplex') {
                            driftPercent += 15;
                            impactFactors.push(`Suboptimal sleep: Moderate impact on ${nutrient}`);
                        }
                    }
                    
                    // 2. SCREEN TIME IMPACT
                    if (lifestyleData.screenTime > 8) {
                        if (nutrient === 'omega3') {
                            driftPercent += 40;
                            impactFactors.push(`High screen time (${lifestyleData.screenTime}h): Eye strain increases Omega-3 demand by 40%`);
                        }
                        if (nutrient === 'vitaminD') {
                            driftPercent += 30;
                            impactFactors.push(`Indoor lifestyle reduces Vitamin D synthesis`);
                        }
                        if (nutrient === 'magnesium') {
                            driftPercent += 25;
                            impactFactors.push(`Blue light exposure increases magnesium needs by 25%`);
                        }
                    } else if (lifestyleData.screenTime > 6) {
                        if (nutrient === 'omega3' || nutrient === 'magnesium') {
                            driftPercent += 15;
                            impactFactors.push(`Moderate screen time affects ${nutrient} needs`);
                        }
                    }
                    
                    // 3. STRESS IMPACT
                    if (lifestyleData.stress >= 4) {
                        if (nutrient === 'magnesium') {
                            driftPercent += 50;
                            impactFactors.push(`High stress (Level ${lifestyleData.stress}): Magnesium depletion increases by 50%`);
                        }
                        if (nutrient === 'bComplex') {
                            driftPercent += 40;
                            impactFactors.push(`Stress increases B vitamin requirements by 40%`);
                        }
                        if (nutrient === 'zinc') {
                            driftPercent += 30;
                            impactFactors.push(`Stress response increases zinc utilization`);
                        }
                        confidence -= 0.1;
                    } else if (lifestyleData.stress >= 3) {
                        if (nutrient === 'magnesium' || nutrient === 'bComplex') {
                            driftPercent += 20;
                            impactFactors.push(`Moderate stress impacts ${nutrient} metabolism`);
                        }
                    }
                    
                    // 4. ACTIVITY IMPACT
                    if (lifestyleData.activity >= 4) {
                        if (nutrient === 'iron') {
                            driftPercent += 35;
                            impactFactors.push(`High activity: Iron needs increase by 35% for oxygen transport`);
                        }
                        if (nutrient === 'magnesium') {
                            driftPercent += 30;
                            impactFactors.push(`Physical activity increases magnesium requirements by 30%`);
                        }
                        if (nutrient === 'zinc') {
                            driftPercent += 20;
                            impactFactors.push(`Exercise increases zinc loss through sweat`);
                        }
                    } else if (lifestyleData.activity >= 3) {
                        if (nutrient === 'iron' || nutrient === 'magnesium') {
                            driftPercent += 15;
                            impactFactors.push(`Moderate activity affects ${nutrient} needs`);
                        }
                    }
                    
                    // 5. MEAL TYPE IMPACT (NEW: Real impact)
                    const mealCoverage = mealImpact[nutrient] || 0.8;
                    const mealDeficit = Math.round((1 - mealCoverage) * 100);
                    driftPercent += mealDeficit;
                    impactFactors.push(`${mealType.charAt(0).toUpperCase() + mealType.slice(1)} diet: Provides approximately ${Math.round(mealCoverage * 100)}% of ${nutrient} needs`);
                    
                    // Add small random variation for realism (5% max)
                    driftPercent += Math.floor(Math.random() * 10) - 5;
                    
                    // Cap between 10-85%
                    driftPercent = Math.max(10, Math.min(85, driftPercent));
                    
                    // Determine status
                    let status = 'stable';
                    if (driftPercent > 40) status = 'high';
                    else if (driftPercent > 20) status = 'moderate';
                    
                    // Calculate future consequences
                    const futureConsequences = this.getFutureConsequences(nutrient, driftPercent, lifestyleData);
                    
                    results[nutrient] = {
                        driftPercent,
                        demand: Math.round(data.rda * (1 + driftPercent/100)),
                        status,
                        color: data.color,
                        icon: data.icon,
                        name: this.formatNutrientName(nutrient),
                        impactFactors,
                        functions: data.functions,
                        sources: data.sources,
                        deficiencySymptoms: data.deficiencySymptoms,
                        futureConsequences,
                        confidence: Math.max(0.7, Math.min(0.95, confidence)),
                        mealCoverage: Math.round(mealCoverage * 100)
                    };
                }
                
                return results;
            }
            
            getFutureConsequences(nutrient, driftPercent, lifestyleData) {
                if (driftPercent < 20) {
                    return {
                        level: 'low',
                        text: 'Maintain current habits for optimal health.',
                        timeframe: 'Long-term stability'
                    };
                } else if (driftPercent < 40) {
                    return {
                        level: 'medium',
                        text: `If this continues for weeks: May experience ${this.getSymptom(nutrient, 'medium')}.`,
                        timeframe: '2-4 weeks'
                    };
                } else {
                    return {
                        level: 'high',
                        text: `If unaddressed for months: Could lead to ${this.getSymptom(nutrient, 'high')}.`,
                        timeframe: '1-3 months'
                    };
                }
            }
            
            getSymptom(nutrient, severity) {
                const symptoms = {
                    magnesium: {
                        medium: 'occasional muscle cramps and sleep issues',
                        high: 'increased fatigue, anxiety, and sleep disturbances'
                    },
                    vitaminD: {
                        medium: 'low energy and mood fluctuations',
                        high: 'bone density concerns and immune challenges'
                    },
                    omega3: {
                        medium: 'dry skin and occasional joint stiffness',
                        high: 'cognitive fog and inflammatory responses'
                    },
                    iron: {
                        medium: 'reduced exercise tolerance and pale complexion',
                        high: 'significant fatigue and shortness of breath'
                    },
                    vitaminC: {
                        medium: 'slower wound healing and dry skin',
                        high: 'immune system vulnerability and gum issues'
                    },
                    zinc: {
                        medium: 'occasional taste changes and slow healing',
                        high: 'hair thinning and immune function decline'
                    },
                    bComplex: {
                        medium: 'energy fluctuations and mood changes',
                        high: 'neurological symptoms and metabolic issues'
                    }
                };
                
                return symptoms[nutrient]?.[severity] || 'health optimization challenges';
            }
            
            formatNutrientName(nutrient) {
                const names = {
                    magnesium: 'Magnesium',
                    vitaminD: 'Vitamin D',
                    omega3: 'Omega-3',
                    iron: 'Iron',
                    vitaminC: 'Vitamin C',
                    zinc: 'Zinc',
                    bComplex: 'B Complex'
                };
                return names[nutrient] || nutrient;
            }
            
            calculateRiskLevel(results) {
                if (!results) return 'LOW';
                
                const averageDrift = Object.values(results).reduce((sum, nutrient) => sum + nutrient.driftPercent, 0) / Object.keys(results).length;
                
                if (averageDrift > 50) return 'HIGH';
                if (averageDrift > 30) return 'MEDIUM';
                return 'LOW';
            }
            
            getRiskDescription(riskLevel, userData) {
                const descriptions = {
                    'LOW': `Excellent! Your lifestyle shows minimal nutrient depletion risk. Keep maintaining your healthy habits with ${userData.sleep}h sleep and moderate activity.`,
                    'MEDIUM': `Your lifestyle factors indicate moderate nutrient depletion risk. Focus on improving sleep (aim for 7-9h) and managing ${userData.screenTime}h screen time to reduce nutrient drift.`,
                    'HIGH': `Significant nutrient drift detected! With ${userData.sleep}h sleep, ${userData.screenTime}h screen time, and stress level ${userData.stress}, your nutrient demands are much higher than average. Consider lifestyle changes.`
                };
                return descriptions[riskLevel] || '';
            }
            
            generateRecommendations(results, userData) {
                const recommendations = [];
                
                // Sort nutrients by drift (highest first)
                const sortedNutrients = Object.entries(results)
                    .sort((a, b) => b[1].driftPercent - a[1].driftPercent)
                    .slice(0, 3);
                
                sortedNutrients.forEach(([nutrient, data]) => {
                    const nutrientName = data.name;
                    const drift = data.driftPercent;
                    
                    let recommendation = {
                        title: `Boost ${nutrientName} Intake`,
                        description: `Increase ${nutrientName.toLowerCase()} by ${drift}% to meet your body's demands. Add ${data.sources[0]} to your daily diet.`,
                        icon: 'restaurant',
                        priority: 'high',
                        confidence: data.confidence
                    };
                    
                    if (nutrient === 'magnesium') {
                        recommendation.description = `Your magnesium demand is ${drift}% above average due to lifestyle factors. Add spinach, almonds, or dark chocolate to your diet.`;
                        recommendation.icon = 'spa';
                    } else if (nutrient === 'vitaminD') {
                        recommendation.description = `Spend 15-20 minutes in sunlight daily. Vitamin D deficiency is common with indoor lifestyles and ${userData.screenTime}h screen time.`;
                        recommendation.icon = 'wb_sunny';
                    } else if (nutrient === 'omega3') {
                        recommendation.description = `Include fatty fish or walnuts in your meals. Omega-3 helps counteract inflammation from ${userData.stress >= 3 ? 'stress' : 'screen time'}.`;
                        recommendation.icon = 'waves';
                    } else if (nutrient === 'iron') {
                        recommendation.description = `Combine iron-rich foods with vitamin C sources for better absorption. Your activity level increases iron needs by ${drift}%.`;
                        recommendation.icon = 'fitness_center';
                    } else if (nutrient === 'bComplex') {
                        recommendation.description = `Add whole grains and eggs to your diet. Stress and activity increase B vitamin requirements by ${drift}%.`;
                        recommendation.icon = 'battery_charging_full';
                    }
                    
                    recommendations.push(recommendation);
                });
                
                // Lifestyle recommendations based on user data
                if (userData.sleep < 7) {
                    recommendations.push({
                        title: 'Improve Sleep Quality',
                        description: `Aim for 7-9 hours of quality sleep. Your current ${userData.sleep}h increases nutrient depletion. Try magnesium-rich foods before bed.`,
                        icon: 'bed',
                        priority: 'high',
                        confidence: 0.9
                    });
                }
                
                if (userData.screenTime > 8) {
                    recommendations.push({
                        title: 'Manage Screen Time',
                        description: `Reduce ${userData.screenTime}h daily screen time. Take breaks using the 20-20-20 rule to reduce eye strain and nutrient depletion.`,
                        icon: 'desktop_windows',
                        priority: 'medium',
                        confidence: 0.85
                    });
                }
                
                if (userData.stress >= 3) {
                    recommendations.push({
                        title: 'Stress Reduction',
                        description: `Practice 5-minute breathing exercises daily. Stress level ${userData.stress}/5 significantly depletes key nutrients.`,
                        icon: 'self_improvement',
                        priority: 'high',
                        confidence: 0.9
                    });
                }
                
                // Meal-specific recommendations
                if (userData.mealType === 'processed') {
                    recommendations.push({
                        title: 'Reduce Processed Foods',
                        description: 'Swap processed snacks for whole foods. Processed foods have 40-60% fewer micronutrients.',
                        icon: 'nutrition',
                        priority: 'high',
                        confidence: 0.95
                    });
                } else if (userData.mealType === 'vegetarian' || userData.mealType === 'vegan') {
                    recommendations.push({
                        title: 'Optimize Plant-Based Diet',
                        description: 'Combine plant iron sources with vitamin C for better absorption. Consider fortified foods.',
                        icon: 'eco',
                        priority: 'medium',
                        confidence: 0.85
                    });
                }
                
                return recommendations;
            }
            
            // What-If simulation logic
            simulateImprovement(userData, changeType) {
                const simulatedData = {...userData};
                let improvement = 0;
                let message = '';
                
                switch(changeType) {
                    case 'more_sleep':
                        simulatedData.sleep = Math.min(8, simulatedData.sleep + 1);
                        improvement = 15;
                        message = `+1 hour sleep could reduce nutrient drift by ${improvement}%`;
                        break;
                    case 'less_screen':
                        simulatedData.screenTime = Math.max(4, simulatedData.screenTime - 2);
                        improvement = 20;
                        message = `-2 hours screen time could reduce nutrient drift by ${improvement}%`;
                        break;
                    case 'reduce_stress':
                        simulatedData.stress = Math.max(1, simulatedData.stress - 1);
                        improvement = 25;
                        message = `Reducing stress by 1 level could reduce nutrient drift by ${improvement}%`;
                        break;
                    case 'more_veggies':
                        improvement = 18;
                        message = `+2 servings of vegetables daily could improve nutrient coverage by ${improvement}%`;
                        break;
                    case 'add_fish':
                        improvement = 22;
                        message = `Adding fish twice weekly could improve Omega-3 and Vitamin D status by ${improvement}%`;
                        break;
                    case 'add_nuts':
                        improvement = 15;
                        message = `Daily nuts could improve magnesium and zinc levels by ${improvement}%`;
                        break;
                }
                
                return { simulatedData, improvement, message };
            }
        }

        // Profile Manager Class
        class ProfileManager {
            constructor() {
                this.storageKey = 'nutrientDriftAI_profile';
                this.historyKey = 'nutrientDriftAI_history';
                this.trendKey = 'nutrientDriftAI_trend';
                this.init();
            }
            
            init() {
                this.loadProfile();
                this.loadHistory();
                this.loadTrendData();
            }
            
            loadProfile() {
                const savedProfile = localStorage.getItem(this.storageKey);
                if (savedProfile) {
                    const profile = JSON.parse(savedProfile);
                    document.getElementById('user-name').value = profile.name || '';
                    document.getElementById('user-age').value = profile.age || '';
                    document.getElementById('user-email').value = profile.email || '';
                }
            }
            
            saveProfile() {
                const profile = {
                    name: document.getElementById('user-name').value,
                    age: document.getElementById('user-age').value,
                    email: document.getElementById('user-email').value,
                    lastUpdated: new Date().toISOString()
                };
                
                localStorage.setItem(this.storageKey, JSON.stringify(profile));
                return profile;
            }
            
            loadHistory() {
                const savedHistory = localStorage.getItem(this.historyKey);
                if (savedHistory) {
                    const history = JSON.parse(savedHistory);
                    this.displayHistory(history);
                    return history;
                }
                return [];
            }
            
            loadTrendData() {
                const savedTrend = localStorage.getItem(this.trendKey);
                if (savedTrend) {
                    return JSON.parse(savedTrend);
                }
                
                // Create demo trend data if none exists
                const trendData = this.generateDemoTrend();
                localStorage.setItem(this.trendKey, JSON.stringify(trendData));
                return trendData;
            }
            
            generateDemoTrend() {
                const trend = [];
                const today = new Date();
                
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    
                    trend.push({
                        date: date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                        riskLevel: ['LOW', 'MEDIUM', 'HIGH'][Math.floor(Math.random() * 3)],
                        averageDrift: 20 + Math.random() * 40,
                        nutrientsAnalyzed: 7
                    });
                }
                
                return trend;
            }
            
            updateTrendData(newAnalysis) {
                const trendData = this.loadTrendData();
                const today = new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                // Remove oldest entry if we have 7 days
                if (trendData.length >= 7) {
                    trendData.shift();
                }
                
                // Add new entry
                const averageDrift = Object.values(newAnalysis.nutrients).reduce((sum, n) => sum + n.driftPercent, 0) / Object.keys(newAnalysis.nutrients).length;
                
                trendData.push({
                    date: today,
                    riskLevel: newAnalysis.riskLevel,
                    averageDrift: Math.round(averageDrift),
                    nutrientsAnalyzed: Object.keys(newAnalysis.nutrients).length
                });
                
                localStorage.setItem(this.trendKey, JSON.stringify(trendData));
                return trendData;
            }
            
            saveAnalysisResult(analysisData) {
                const history = this.loadHistory();
                const result = {
                    id: Date.now(),
                    date: new Date().toLocaleString(),
                    riskLevel: analysisData.riskLevel,
                    nutrients: analysisData.nutrients,
                    userData: analysisData.userData,
                    summary: this.generateSummary(analysisData)
                };
                
                history.unshift(result); // Add to beginning
                if (history.length > 10) history.pop(); // Keep only last 10
                
                localStorage.setItem(this.historyKey, JSON.stringify(history));
                this.displayHistory(history);
                
                // Update trend data
                this.updateTrendData(analysisData);
                
                return result;
            }
            
            generateSummary(analysisData) {
                const topNutrient = Object.entries(analysisData.nutrients)
                    .sort((a, b) => b[1].driftPercent - a[1].driftPercent)[0];
                
                return {
                    highestDrift: topNutrient[0],
                    driftPercent: topNutrient[1].driftPercent,
                    riskLevel: analysisData.riskLevel,
                    nutrientCount: Object.keys(analysisData.nutrients).length,
                    averageDrift: Math.round(Object.values(analysisData.nutrients).reduce((sum, n) => sum + n.driftPercent, 0) / Object.keys(analysisData.nutrients).length)
                };
            }
            
            displayHistory(history) {
                const container = document.getElementById('saved-results');
                if (!container) return;
                
                if (history.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="text-align: center; padding: 30px; color: rgba(255,255,255,0.5);">
                            <i class="material-icons" style="font-size: 48px; margin-bottom: 15px;">folder_open</i>
                            <p>No saved analyses yet. Complete your first analysis to see it here.</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = history.map(result => `
                    <div class="history-item" data-id="${result.id}" 
                         style="background: rgba(255,255,255,0.05); padding: 15px; margin-bottom: 10px; 
                                border-radius: 10px; border-left: 4px solid ${
                                    result.riskLevel === 'HIGH' ? '#F44336' : 
                                    result.riskLevel === 'MEDIUM' ? '#FFC107' : '#4CAF50'
                                }; cursor: pointer; transition: all 0.3s ease;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 600; color: white;">Analysis ${result.date}</div>
                                <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-top: 5px;">
                                    <span class="nutrient-status-badge status-${result.riskLevel.toLowerCase()}">${result.riskLevel} RISK</span> â¢ 
                                    Avg Drift: ${result.summary.averageDrift}% â¢ 
                                    Highest: ${result.summary.highestDrift} (+${result.summary.driftPercent}%)
                                </div>
                            </div>
                            <i class="material-icons" style="color: rgba(255,255,255,0.5);">chevron_right</i>
                        </div>
                    </div>
                `).join('');
                
                // Add click event to history items
                container.querySelectorAll('.history-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const id = parseInt(item.dataset.id);
                        const history = this.loadHistory();
                        const result = history.find(r => r.id === id);
                        if (result) {
                            this.viewResult(result);
                        }
                    });
                });
            }
            
            viewResult(result) {
                // Create a detailed view modal or update current screen
                const detailHTML = `
                    <div class="glass-card" style="margin: 20px 0;">
                        <h3><i class="material-icons">history</i> Analysis from ${result.date}</h3>
                        <div style="margin: 15px 0;">
                            <div style="display: inline-block; padding: 5px 15px; 
                                        background: ${
                                            result.riskLevel === 'HIGH' ? 'rgba(244, 67, 54, 0.2)' : 
                                            result.riskLevel === 'MEDIUM' ? 'rgba(255, 193, 7, 0.2)' : 'rgba(76, 175, 80, 0.2)'
                                        }; 
                                        border: 1px solid ${
                                            result.riskLevel === 'HIGH' ? '#F44336' : 
                                            result.riskLevel === 'MEDIUM' ? '#FFC107' : '#4CAF50'
                                        };
                                        border-radius: 20px; color: ${
                                            result.riskLevel === 'HIGH' ? '#F44336' : 
                                            result.riskLevel === 'MEDIUM' ? '#FFC107' : '#4CAF50'
                                        }; font-weight: 600;">
                                ${result.riskLevel} RISK
                            </div>
                        </div>
                        
                        <h4>Nutrient Drift Analysis:</h4>
                        <div style="margin-top: 15px;">
                            ${Object.entries(result.nutrients).map(([nutrient, data]) => `
                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; 
                                            background: rgba(255,255,255,0.05); margin-bottom: 8px; border-radius: 8px;">
                                    <div>
                                        <span style="font-weight: 600;">${data.name}</span>
                                        <span class="nutrient-status-badge status-${data.status}" style="margin-left: 10px;">
                                            ${data.status.toUpperCase()}
                                        </span>
                                    </div>
                                    <span style="color: ${data.color}; font-weight: 600;">+${data.driftPercent}%</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        <h4 style="margin-top: 20px;">Lifestyle Factors:</h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
                            <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px;">
                                <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">Sleep</div>
                                <div style="font-weight: 600;">${result.userData.sleep}h</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px;">
                                <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">Screen Time</div>
                                <div style="font-weight: 600;">${result.userData.screenTime}h</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px;">
                                <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">Stress Level</div>
                                <div style="font-weight: 600;">${result.userData.stress}/5</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px;">
                                <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">Activity</div>
                                <div style="font-weight: 600;">${result.userData.activity}/5</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px;">
                            <div style="font-size: 0.9rem; color: rgba(255,255,255,0.7);">Diet Type</div>
                            <div style="font-weight: 600; text-transform: capitalize;">${result.userData.mealType}</div>
                        </div>
                    </div>
                `;
                
                // Update the profile screen content temporarily
                const container = document.getElementById('saved-results');
                container.innerHTML = detailHTML + 
                    `<button class="btn" id="back-to-history" style="margin-top: 20px; width: 100%;">
                        <i class="material-icons">arrow_back</i> Back to History
                    </button>`;
                    
                document.getElementById('back-to-history').addEventListener('click', () => {
                    this.displayHistory(this.loadHistory());
                });
            }
            
            clearHistory() {
                if (confirm('Are you sure you want to clear all analysis history?')) {
                    localStorage.removeItem(this.historyKey);
                    localStorage.removeItem(this.trendKey);
                    this.displayHistory([]);
                    window.app.soundManager.showNotification('Analysis history cleared');
                }
            }
            
            exportCurrentAnalysis(analysisResults, userData) {
                if (!analysisResults) {
                    window.app.soundManager.showNotification('No analysis data to export');
                    return;
                }
                
                const riskLevel = window.app.aiEngine.calculateRiskLevel(analysisResults);
                const analysisData = {
                    riskLevel,
                    nutrients: analysisResults,
                    userData,
                    exportedAt: new Date().toISOString()
                };
                
                // Create downloadable JSON
                const dataStr = JSON.stringify(analysisData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                const exportFileDefaultName = `NutrientDriftAI_Analysis_${new Date().toISOString().slice(0,10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                window.app.soundManager.showNotification('Analysis exported successfully');
            }
            
            displayTrendChart() {
                const trendData = this.loadTrendData();
                const container = document.getElementById('trend-history');
                
                if (!container || trendData.length === 0) return;
                
                container.innerHTML = '';
                
                trendData.forEach(day => {
                    const bar = document.createElement('div');
                    bar.className = 'trend-bar';
                    bar.style.height = `${Math.min(100, day.averageDrift)}%`;
                    bar.style.background = day.riskLevel === 'HIGH' ? 'linear-gradient(to top, #F44336, #FFC107)' :
                                         day.riskLevel === 'MEDIUM' ? 'linear-gradient(to top, #FFC107, #FF9800)' :
                                         'linear-gradient(to top, #4CAF50, #2196F3)';
                    bar.title = `${day.date}: ${day.averageDrift}% average drift (${day.riskLevel} risk)`;
                    container.appendChild(bar);
                });
            }
        }

        // Main Application
        class NutrientDriftApp {
            constructor() {
                this.aiEngine = new NutrientAI();
                this.soundManager = new SoundManager();
                this.profileManager = new ProfileManager();
                this.currentScreen = 'dashboard';
                this.userData = {
                    sleep: 7,
                    screenTime: 6,
                    stress: 3,
                    activity: 3,
                    mealType: 'typical'
                };
                this.analysisResults = null;
                
                this.initialize();
            }
            
            initialize() {
                this.initializeParticles();
                this.initializeSoundVisualizer();
                this.bindEvents();
                this.bindProfileEvents();
                this.bindWhatIfEvents();
                this.initializeSidebar();
                this.initializeProgressIndicator();
                this.setupRippleEffects();
                this.initializeSliders();
                this.initializeStressDots();
                this.initializeMealOptions();
                
                // Show dashboard by default
                this.showScreen('dashboard');
                
                // Load trend chart
                this.profileManager.displayTrendChart();
            }
            
            initializeParticles() {
                const container = document.getElementById('nutrient-particles');
                if (!container) return;
                
                // Clear existing particles
                container.innerHTML = '';
                
                // Create 25 particles
                for (let i = 0; i < 25; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    
                    // Randomly choose color
                    const colors = ['green', 'blue', 'yellow', 'red'];
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    particle.classList.add(`particle-${color}`);
                    
                    // Random size and position
                    const size = Math.random() * 30 + 15;
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.left = `${Math.random() * 100}%`;
                    particle.style.top = `${Math.random() * 100}%`;
                    
                    // Random animation
                    const duration = Math.random() * 40 + 20;
                    const delay = Math.random() * 10;
                    particle.style.animation = `float ${duration}s linear ${delay}s infinite`;
                    
                    container.appendChild(particle);
                }
            }
            
            initializeSoundVisualizer() {
                const visualizer = document.getElementById('sound-visualizer');
                if (!visualizer) return;
                
                visualizer.innerHTML = '';
                
                for (let i = 0; i < 30; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'sound-bar';
                    bar.style.left = `${i * 7}px`;
                    bar.style.animationDelay = `${i * 0.03}s`;
                    visualizer.appendChild(bar);
                }
            }
            
            setupRippleEffects() {
                document.addEventListener('click', (e) => {
                    const clickable = e.target.closest('.btn, .meal-option, .stress-dot, .nutrient-item, .nav-item, .dashboard-card, .what-if-btn');
                    if (clickable) {
                        const ripple = document.createElement('span');
                        ripple.classList.add('ripple');
                        
                        const rect = clickable.getBoundingClientRect();
                        const size = Math.max(rect.width, rect.height);
                        const x = e.clientX - rect.left - size / 2;
                        const y = e.clientY - rect.top - size / 2;
                        
                        ripple.style.width = ripple.style.height = size + 'px';
                        ripple.style.left = x + 'px';
                        ripple.style.top = y + 'px';
                        
                        clickable.appendChild(ripple);
                        
                        setTimeout(() => ripple.remove(), 600);
                        
                        // Play sound for some elements
                        if (clickable.classList.contains('btn') || 
                            clickable.classList.contains('nav-item') ||
                            clickable.classList.contains('meal-option') ||
                            clickable.classList.contains('what-if-btn')) {
                            this.soundManager.playClick();
                        }
                    }
                });
            }
            
            initializeSidebar() {
                const navItems = document.querySelectorAll('.nav-item');
                navItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const screen = item.getAttribute('data-screen');
                        
                        // Update active state
                        navItems.forEach(nav => nav.classList.remove('active'));
                        item.classList.add('active');
                        
                        // Navigate to screen
                        this.showScreen(screen);
                        this.soundManager.playClick();
                    });
                });
            }
            
            initializeProgressIndicator() {
                const indicator = document.getElementById('progress-indicator');
                if (!indicator) return;
                
                indicator.innerHTML = '';
                
                const screens = ['dashboard', 'lifestyle', 'meal', 'analysis', 'results', 'actions', 'final'];
                
                screens.forEach((screen, index) => {
                    const dot = document.createElement('div');
                    dot.className = 'progress-dot';
                    dot.dataset.screen = screen;
                    indicator.appendChild(dot);
                });
                
                this.updateProgressIndicator();
            }
            
            updateProgressIndicator() {
                const screens = ['dashboard', 'lifestyle', 'meal', 'analysis', 'results', 'actions', 'final'];
                const currentIndex = screens.indexOf(this.currentScreen);
                
                document.querySelectorAll('.progress-dot').forEach((dot, index) => {
                    dot.classList.toggle('active', index <= currentIndex);
                });
            }
            
            initializeSliders() {
                // Sleep slider
                const sleepSlider = document.getElementById('sleep-slider');
                const sleepValue = document.getElementById('sleep-value');
                if (sleepSlider && sleepValue) {
                    sleepSlider.addEventListener('input', () => {
                        const value = parseFloat(sleepSlider.value);
                        sleepValue.textContent = value;
                        this.userData.sleep = value;
                        this.soundManager.playClick();
                    });
                }
                
                // Screen time slider
                const screenSlider = document.getElementById('screen-slider');
                const screenValue = document.getElementById('screen-value');
                if (screenSlider && screenValue) {
                    screenSlider.addEventListener('input', () => {
                        const value = parseInt(screenSlider.value);
                        screenValue.textContent = value;
                        this.userData.screenTime = value;
                        this.soundManager.playClick();
                    });
                }
                
                // Activity slider
                const activitySlider = document.getElementById('activity-slider');
                const activityValue = document.getElementById('activity-value');
                const activityLabels = ['Sedentary', 'Light', 'Moderate', 'Active', 'Very Active'];
                if (activitySlider && activityValue) {
                    activitySlider.addEventListener('input', () => {
                        const value = parseInt(activitySlider.value);
                        activityValue.textContent = activityLabels[value - 1];
                        this.userData.activity = value;
                        this.soundManager.playClick();
                    });
                }
            }
            
            initializeStressDots() {
                const stressDots = document.querySelectorAll('.stress-dot');
                stressDots.forEach(dot => {
                    dot.addEventListener('click', () => {
                        this.soundManager.playClick();
                        stressDots.forEach(d => d.classList.remove('active'));
                        dot.classList.add('active');
                        this.userData.stress = parseInt(dot.getAttribute('data-level'));
                    });
                });
            }
            
            initializeMealOptions() {
                const mealOptions = document.querySelectorAll('.meal-option');
                mealOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        this.soundManager.playClick();
                        mealOptions.forEach(opt => opt.classList.remove('active'));
                        option.classList.add('active');
                        this.userData.mealType = option.getAttribute('data-meal');
                    });
                });
            }
            
            bindEvents() {
                // Sound controls
                document.getElementById('sound-toggle').addEventListener('click', () => {
                    const enabled = this.soundManager.toggleSounds();
                    document.getElementById('sound-toggle').classList.toggle('active', enabled);
                    this.soundManager.playClick();
                });
                
                document.getElementById('music-toggle').addEventListener('click', () => {
                    const enabled = this.soundManager.toggleMusic();
                    document.getElementById('music-toggle').classList.toggle('active', enabled);
                    this.soundManager.playClick();
                });
                
                // Navigation buttons
                document.getElementById('start-from-dashboard').addEventListener('click', () => this.showScreen('lifestyle'));
                document.getElementById('start-analysis-btn').addEventListener('click', () => this.showScreen('lifestyle'));
                document.getElementById('back-to-dashboard-from-lifestyle').addEventListener('click', () => this.showScreen('dashboard'));
                document.getElementById('to-meal').addEventListener('click', () => this.showScreen('meal'));
                document.getElementById('back-to-lifestyle').addEventListener('click', () => this.showScreen('lifestyle'));
                document.getElementById('to-analysis').addEventListener('click', () => this.startAnalysis());
                document.getElementById('skip-meal').addEventListener('click', () => this.startAnalysis());
                document.getElementById('back-to-analysis-from-results').addEventListener('click', () => this.showScreen('analysis'));
                document.getElementById('to-actions').addEventListener('click', () => this.showScreen('actions'));
                document.getElementById('back-to-results').addEventListener('click', () => this.showScreen('results'));
                document.getElementById('to-final').addEventListener('click', () => this.showScreen('final'));
                document.getElementById('restart').addEventListener('click', () => this.restartApp());
                document.getElementById('save-final-analysis').addEventListener('click', () => this.saveCurrentAnalysis());
                document.getElementById('close-detail').addEventListener('click', () => this.closeDetailPanel());
            }
            
            bindProfileEvents() {
                // Save profile button
                document.getElementById('save-profile')?.addEventListener('click', () => {
                    this.profileManager.saveProfile();
                    this.soundManager.showNotification('Profile saved successfully');
                    this.soundManager.playSuccess();
                });
                
                // Save current analysis button
                document.getElementById('save-current-analysis')?.addEventListener('click', () => {
                    this.saveCurrentAnalysis();
                });
                
                // Export buttons
                document.getElementById('export-pdf')?.addEventListener('click', () => {
                    this.soundManager.showNotification('PDF export feature coming soon');
                });
                
                document.getElementById('export-csv')?.addEventListener('click', () => {
                    if (this.analysisResults) {
                        this.profileManager.exportCurrentAnalysis(this.analysisResults, this.userData);
                    } else {
                        this.soundManager.showNotification('No analysis data to export');
                    }
                });
                
                // Clear history button
                document.getElementById('clear-history')?.addEventListener('click', () => {
                    this.profileManager.clearHistory();
                });
                
                // Back button from profile
                document.getElementById('back-to-dashboard-from-profile')?.addEventListener('click', () => {
                    this.showScreen('dashboard');
                });
            }
            
            bindWhatIfEvents() {
                // Meal input what-if buttons
                document.querySelectorAll('.what-if-btn[data-change]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const change = e.target.getAttribute('data-change');
                        const result = this.aiEngine.simulateImprovement(this.userData, change);
                        
                        const resultDiv = document.getElementById('what-if-result');
                        resultDiv.innerHTML = `<p>${result.message}</p>`;
                        resultDiv.style.display = 'block';
                        
                        this.soundManager.playSuccess();
                    });
                });
                
                // Results screen what-if buttons
                document.getElementById('what-if-sleep')?.addEventListener('click', () => {
                    this.showWhatIfResult('more_sleep', '+1 hour sleep could reduce nutrient drift by 15-20%');
                });
                
                document.getElementById('what-if-screen')?.addEventListener('click', () => {
                    this.showWhatIfResult('less_screen', '-2 hours screen time could reduce eye nutrient demands by 20-25%');
                });
                
                document.getElementById('what-if-stress')?.addEventListener('click', () => {
                    this.showWhatIfResult('reduce_stress', 'Reducing stress by 1 level could lower magnesium depletion by 25-30%');
                });
                
                document.getElementById('what-if-veggies')?.addEventListener('click', () => {
                    this.showWhatIfResult('more_veggies', '+2 servings of vegetables could improve micronutrient coverage by 18-22%');
                });
            }
            
            showWhatIfResult(changeType, message) {
                const resultDiv = document.getElementById('quick-improvement-result');
                const textElement = document.getElementById('improvement-text');
                
                if (resultDiv && textElement) {
                    textElement.textContent = message;
                    resultDiv.style.display = 'block';
                    this.soundManager.playSuccess();
                    
                    // Hide after 5 seconds
                    setTimeout(() => {
                        resultDiv.style.display = 'none';
                    }, 5000);
                }
            }
            
            showScreen(screenName) {
                // Hide all screens
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
                
                // Show target screen
                const targetScreen = document.getElementById(`screen-${screenName}`);
                if (targetScreen) {
                    targetScreen.classList.add('active');
                    this.currentScreen = screenName;
                    this.updateProgressIndicator();
                    
                    // Update sidebar active state
                    document.querySelectorAll('.nav-item').forEach(item => {
                        item.classList.remove('active');
                        if (item.getAttribute('data-screen') === screenName) {
                            item.classList.add('active');
                        }
                    });
                    
                    this.soundManager.playTransition();
                    
                    // Special handling for certain screens
                    if (screenName === 'results' && this.analysisResults) {
                        this.updateResultsDashboard();
                    } else if (screenName === 'actions' && this.analysisResults) {
                        this.updateActionPlan();
                    } else if (screenName === 'profile') {
                        this.profileManager.displayHistory(this.profileManager.loadHistory());
                    } else if (screenName === 'dashboard') {
                        this.profileManager.displayTrendChart();
                    }
                }
            }
            
            async startAnalysis() {
                this.showScreen('analysis');
                this.soundManager.playTransition();
                
                // Simulate analysis process
                const analysisText = document.getElementById('analysis-text');
                const steps = [
                    "Initializing neural network analysis...",
                    "Processing sleep patterns and circadian rhythms...",
                    "Analyzing screen time impact on neurotransmitter systems...",
                    "Evaluating stress biomarkers and cortisol patterns...",
                    "Calculating activity-induced nutrient turnover...",
                    "Assessing meal nutrient coverage and bioavailability...",
                    "Cross-referencing with 180+ biochemical pathways...",
                    "Generating personalized nutrient drift profile...",
                    "Finalizing AI recommendations with confidence scoring..."
                ];
                
                for (let i = 0; i < steps.length; i++) {
                    if (analysisText) {
                        analysisText.textContent = steps[i];
                    }
                    await this.sleep(700);
                }
                
                // Run REAL AI analysis
                this.analysisResults = this.aiEngine.analyzeNutrientDrift(this.userData, this.userData.mealType);
                
                // Update final stats
                this.updateFinalStats();
                
                // Show success sound and notification
                this.soundManager.playSuccess();
                this.soundManager.showNotification("Analysis complete! Check your results.");
                
                // Update results and show them
                this.updateResultsDashboard();
                
                // Show results screen after delay
                setTimeout(() => {
                    this.showScreen('results');
                }, 1000);
            }
            
            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            updateFinalStats() {
                if (!this.analysisResults) return;
                
                // Calculate stats
                const hasHighDrift = Object.values(this.analysisResults).some(n => n.driftPercent > 40);
                const avgConfidence = Object.values(this.analysisResults).reduce((sum, n) => sum + n.confidence, 0) / Object.keys(this.analysisResults).length;
                
                document.getElementById('stat-discovered').textContent = hasHighDrift ? '92%' : '68%';
                document.getElementById('stat-improvement').textContent = '2.4x';
                document.getElementById('stat-confidence').textContent = `${Math.round(avgConfidence * 100)}%`;
                
                // Update trend visualization
                const avgDrift = Object.values(this.analysisResults).reduce((sum, n) => sum + n.driftPercent, 0) / Object.keys(this.analysisResults).length;
                const potentialDrift = avgDrift * 0.7; // 30% improvement potential
                
                document.getElementById('trend-current').style.height = `${Math.min(100, avgDrift)}%`;
                document.getElementById('trend-potential').style.height = `${Math.min(100, potentialDrift)}%`;
            }
            
            updateResultsDashboard() {
                if (!this.analysisResults) return;
                
                // Update risk assessment
                const riskLevel = this.aiEngine.calculateRiskLevel(this.analysisResults);
                const riskElement = document.getElementById('risk-level');
                const riskDescription = document.getElementById('risk-description');
                
                if (riskElement) {
                    riskElement.className = 'risk-level ' + 
                        (riskLevel === 'HIGH' ? 'risk-high' : 
                         riskLevel === 'MEDIUM' ? 'risk-medium' : 'risk-low');
                    riskElement.textContent = riskLevel + ' RISK';
                }
                
                if (riskDescription) {
                    riskDescription.textContent = this.aiEngine.getRiskDescription(riskLevel, this.userData);
                }
                
                // Update nutrient list
                const nutrientList = document.getElementById('nutrient-list');
                if (nutrientList) {
                    nutrientList.innerHTML = '';
                    
                    // Sort by drift percentage (highest first)
                    const sortedNutrients = Object.entries(this.analysisResults)
                        .sort((a, b) => b[1].driftPercent - a[1].driftPercent);
                    
                    sortedNutrients.forEach(([nutrient, data]) => {
                        const nutrientItem = document.createElement('div');
                        nutrientItem.className = `glass-card nutrient-item`;
                        nutrientItem.dataset.nutrient = nutrient;
                        nutrientItem.innerHTML = `
                            <div class="nutrient-icon">
                                <i class="material-icons">${data.icon}</i>
                            </div>
                            <div class="nutrient-info">
                                <div class="nutrient-name">${data.name}</div>
                                <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
                                    <div class="nutrient-status" style="color: ${data.color}">
                                        ${data.status === 'high' ? 'High Drift' : 
                                          data.status === 'moderate' ? 'Moderate Drift' : 'Stability'}
                                    </div>
                                    <span class="nutrient-status-badge status-${data.status}">
                                        ${data.status.toUpperCase()}
                                    </span>
                                    <div class="confidence-indicator" style="margin: 0; font-size: 0.8rem;">
                                        <span>${Math.round(data.confidence * 100)}%</span>
                                    </div>
                                </div>
                            </div>
                            <div class="nutrient-drift" style="color: ${data.color}">+${data.driftPercent}%</div>
                        `;
                        
                        nutrientItem.addEventListener('click', () => this.showNutrientDetail(nutrient, data));
                        nutrientList.appendChild(nutrientItem);
                    });
                }
            }
            
            updateActionPlan() {
                if (!this.analysisResults) return;
                
                const actionGrid = document.getElementById('action-grid');
                if (actionGrid) {
                    actionGrid.innerHTML = '';
                    
                    const recommendations = this.aiEngine.generateRecommendations(this.analysisResults, this.userData);
                    
                    recommendations.forEach(rec => {
                        const actionCard = document.createElement('div');
                        actionCard.className = 'glass-card action-card';
                        actionCard.innerHTML = `
                            <h4><i class="material-icons">${rec.icon}</i> ${rec.title}</h4>
                            <p>${rec.description}</p>
                            <div class="confidence-indicator" style="margin-top: 15px;">
                                <span>AI Confidence:</span>
                                <div class="confidence-bar">
                                    <div class="confidence-fill ${rec.confidence > 0.8 ? 'confidence-high' : rec.confidence > 0.7 ? 'confidence-medium' : 'confidence-low'}" 
                                         style="width: ${rec.confidence * 100}%"></div>
                                </div>
                                <span>${Math.round(rec.confidence * 100)}%</span>
                            </div>
                            ${rec.priority === 'high' ? '<div style="position: absolute; top: 10px; right: 10px; background: #F44336; color: white; padding: 3px 8px; border-radius: 10px; font-size: 12px;">Priority</div>' : ''}
                        `;
                        
                        actionGrid.appendChild(actionCard);
                    });
                }
            }
            
            showNutrientDetail(nutrient, data) {
                const detailPanel = document.getElementById('detail-panel');
                const detailTitle = document.getElementById('detail-title');
                const detailContent = document.getElementById('detail-content');
                
                if (!detailPanel || !detailTitle || !detailContent) return;
                
                detailTitle.textContent = `${data.name} Analysis`;
                
                let detailHTML = `
                    <div class="glass-card" style="margin-bottom: 20px;">
                        <h3 style="color: ${data.color}; margin-bottom: 15px;">${data.name} Drift: +${data.driftPercent}%</h3>
                        <p>Your lifestyle indicates a <strong style="color: ${data.color}">${data.driftPercent}% higher demand</strong> for ${data.name.toLowerCase()} compared to standard recommendations.</p>
                        <div class="confidence-indicator" style="margin-top: 15px;">
                            <span>AI Confidence:</span>
                            <div class="confidence-bar">
                                <div class="confidence-fill ${data.confidence > 0.8 ? 'confidence-high' : data.confidence > 0.7 ? 'confidence-medium' : 'confidence-low'}" 
                                     style="width: ${data.confidence * 100}%"></div>
                            </div>
                            <span>${Math.round(data.confidence * 100)}%</span>
                        </div>
                    </div>
                    
                    <div class="glass-card" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px;">Key Functions</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                `;
                
                data.functions.forEach(func => {
                    detailHTML += `<span style="background: ${data.color}20; color: ${data.color}; padding: 8px 12px; border-radius: 8px; font-size: 0.9rem;">${func}</span>`;
                });
                
                detailHTML += `
                        </div>
                    </div>
                    
                    <div class="glass-card" style="margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px;">Why This Happened</h4>
                        <ul style="padding-left: 20px;">
                `;
                
                data.impactFactors.forEach(factor => {
                    detailHTML += `<li style="margin-bottom: 8px;">${factor}</li>`;
                });
                
                detailHTML += `
                        </ul>
                    </div>
                    
                    <div class="consequence-box ${data.futureConsequences.level}">
                        <h4 style="color: ${data.futureConsequences.level === 'high' ? '#F44336' : data.futureConsequences.level === 'medium' ? '#FFC107' : '#4CAF50'}; margin-bottom: 10px;">
                            <i class="material-icons" style="vertical-align: middle;">warning</i> Future Considerations (${data.futureConsequences.timeframe})
                        </h4>
                        <p>${data.futureConsequences.text}</p>
                    </div>
                    
                    <div class="glass-card" style="margin: 20px 0;">
                        <h4 style="margin-bottom: 15px;">Top Food Sources</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                `;
                
                data.sources.forEach(source => {
                    detailHTML += `<span style="background: rgba(255, 255, 255, 0.1); color: white; padding: 8px 12px; border-radius: 8px; font-size: 0.9rem;">${source}</span>`;
                });
                
                detailHTML += `
                        </div>
                    </div>
                    
                    <div class="glass-card" style="background: ${data.color}10; border-color: ${data.color}30;">
                        <h4 style="color: ${data.color}; margin-bottom: 10px;"><i class="material-icons" style="vertical-align: middle;">lightbulb</i> AI Recommendation</h4>
                        <p>Increase your intake of ${data.sources[0].toLowerCase()} and ${data.sources[1].toLowerCase()}. Aim for ${data.demand}${this.analysisResults[nutrient].key ? this.analysisResults[nutrient].key : ''} daily to meet your body's increased demands.</p>
                    </div>
                `;
                
                detailContent.innerHTML = detailHTML;
                detailPanel.classList.add('active');
                this.soundManager.playClick();
            }
            
            closeDetailPanel() {
                document.getElementById('detail-panel').classList.remove('active');
                this.soundManager.playClick();
            }
            
            saveCurrentAnalysis() {
                if (this.analysisResults) {
                    const riskLevel = this.aiEngine.calculateRiskLevel(this.analysisResults);
                    this.profileManager.saveAnalysisResult({
                        riskLevel,
                        nutrients: this.analysisResults,
                        userData: this.userData
                    });
                    this.soundManager.showNotification('Analysis saved to history! View it in Profile & Results.');
                    this.soundManager.playSuccess();
                } else {
                    this.soundManager.showNotification('No current analysis to save');
                }
            }
            
            restartApp() {
                // Reset user data
                this.userData = {
                    sleep: 7,
                    screenTime: 6,
                    stress: 3,
                    activity: 3,
                    mealType: 'typical'
                };
                
                // Reset UI elements
                document.getElementById('sleep-slider').value = 7;
                document.getElementById('sleep-value').textContent = 7;
                document.getElementById('screen-slider').value = 6;
                document.getElementById('screen-value').textContent = 6;
                document.getElementById('activity-slider').value = 3;
                document.getElementById('activity-value').textContent = 'Moderate';
                
                document.querySelectorAll('.stress-dot').forEach(dot => dot.classList.remove('active'));
                document.querySelector('.stress-dot[data-level="3"]').classList.add('active');
                
                document.querySelectorAll('.meal-option').forEach(option => option.classList.remove('active'));
                document.querySelector('.meal-option[data-meal="typical"]').classList.add('active');
                
                // Reset what-if results
                document.getElementById('what-if-result').style.display = 'none';
                document.getElementById('quick-improvement-result').style.display = 'none';
                
                // Reset results
                this.analysisResults = null;
                
                // Go to dashboard
                this.showScreen('dashboard');
                this.soundManager.showNotification("Ready for a new analysis!");
                this.soundManager.playTransition();
            }
        }

        // Initialize the app when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.app = new NutrientDriftApp();
            
            // Add parallax effect to particles
            document.addEventListener('mousemove', (e) => {
                const particles = document.querySelectorAll('.particle');
                const shapes = document.querySelectorAll('.geometric-shape');
                const x = e.clientX / window.innerWidth;
                const y = e.clientY / window.innerHeight;
                
                particles.forEach((particle, index) => {
                    const speed = (index % 3 + 1) * 0.5;
                    const xOffset = (x - 0.5) * speed * 20;
                    const yOffset = (y - 0.5) * speed * 20;
                    
                    particle.style.transform = `translate(${xOffset}px, ${yOffset}px)`;
                });
                
                shapes.forEach((shape, index) => {
                    const speed = (index % 3 + 1) * 0.3;
                    const xOffset = (x - 0.5) * speed * 10;
                    const yOffset = (y - 0.5) * speed * 10;
                    
                    shape.style.transform = `translate(${xOffset}px, ${yOffset}px)`;
                });
            });
        });
    </script>
</body>
</html>